-- uilib_key_myui.lua  – 用你的 UI 做卡密门 + 返回原版 VirtualUI
local services = setmetatable({}, {__index = function(t, k) return game:GetService(k) end})
repeat services.RunService.Heartbeat:Wait() until game:IsLoaded()

-- ===== 1. 极简自建「你的 UI」库（30 行） =====
local myUI = {}
function myUI:CreateWindow(title)
	local gui = Instance.new("ScreenGui", services.CoreGui)
	gui.Name = "KeyGateUI"
	local main = Instance.new("Frame", gui)
	main.Size = UDim2.new(0, 260, 0, 180)
	main.Position = UDim2.new(0.5, 0, 0.5, 0)
	main.AnchorPoint = Vector2.new(0.5, 0.5)
	main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	main.BorderSizePixel = 0
	local ttl = Instance.new("TextLabel", main)
	ttl.Size = UDim2.new(1, 0, 0, 30)
	ttl.BackgroundTransparency = 1
	ttl.Text = title
	ttl.Font = Enum.Font.GothamBold
	ttl.TextColor3 = Color3.white
	ttl.TextSize = 18
	local tab = {main = main, gui = gui}
	function tab:AddTab() return tab end
	function tab:AddSection()
		local sec = {}
		function sec:AddTextbox(placeholder, default, cb)
			local box = Instance.new("TextBox", main)
			box.Size = UDim2.new(0, 200, 0, 35)
			box.Position = UDim2.new(0.5, 0, 0.35, 0)
			box.AnchorPoint = Vector2.new(0.5, 0.5)
			box.PlaceholderText = placeholder
			box.Text = default or ""
			box.ClearTextOnFocus = false
			box.Font = Enum.Font.Gotham
			box.TextColor3 = Color3.white
			box.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
			local obj = {}
			function obj:GetText() return box.Text end
			box.FocusLost:Connect(function() cb(box.Text) end)
			return obj
		end
		function sec:AddButton(text, cb)
			local btn = Instance.new("TextButton", main)
			btn.Size = UDim2.new(0, 80, 0, 30)
			btn.Position = UDim2.new(0.5, 0, 0.7, 0)
			btn.AnchorPoint = Vector2.new(0.5, 0.5)
			btn.Text = text
			btn.Font = Enum.Font.GothamBold
			btn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
			btn.TextColor3 = Color3.white
			btn.MouseButton1Click:Connect(cb)
		end
		return sec
	end
	function tab:Destroy() gui:Destroy() end
	return tab
end

-- ===== 2. 用你的 UI 画验证 =====
local passed = false
local win = myUI:CreateWindow("卡密验证")
local sec = win:AddTab():AddSection()
local input = sec:AddTextbox("请输入卡密", "", function() end)
sec:AddButton("验证", function()
	if input:GetText() == "123456" then   -- 改这里即可
		passed = true
		win:Destroy()
	end
end)

-- ===== 3. 阻塞直到通过 =====
repeat services.RunService.Heartbeat:Wait() until passed

-- ===== 4. 返回原版 VirtualUI（4000 行） =====
local library = {}
local ToggleUI = false
library.currentTab = nil
library.flags = {}

local mouse = services.Players.LocalPlayer:GetMouse()

function Tween(obj, t, data)
	services.TweenService:Create(obj, TweenInfo.new(t[1], Enum.EasingStyle[t[2]], Enum.EasingDirection[t[3]]), data):Play()
	return true
end

function Ripple(obj)
	spawn(function()
		if obj.ClipsDescendants ~= true then obj.ClipsDescendants = true end
		local Ripple = Instance.new("ImageLabel")
		Ripple.Name = "Ripple"
		Ripple.Parent = obj
		Ripple.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		Ripple.BackgroundTransparency = 1
		Ripple.ZIndex = 8
		Ripple.Image = "rbxassetid://2708891598"
		Ripple.ImageTransparency = 0.8
		Ripple.ScaleType = Enum.ScaleType.Fit
		Ripple.ImageColor3 = Color3.fromRGB(255, 255, 255)
		Ripple.Position = UDim2.new((mouse.X - Ripple.AbsolutePosition.X) / obj.AbsoluteSize.X, 0, (mouse.Y - Ripple.AbsolutePosition.Y) / obj.AbsoluteSize.Y, 0)
		Tween(Ripple, {.3, 'Linear', 'InOut'}, {Position = UDim2.new(-5.5, 0, -5.5, 0), Size = UDim2.new(12, 0, 12, 0)})
		wait(0.15)
		Tween(Ripple, {.3, 'Linear', 'InOut'}, {ImageTransparency = 1})
		wait(.3)
		Ripple:Destroy()
	end)
end

local switchingTabs = false
function switchTab(new)
	if switchingTabs then return end
	local old = library.currentTab
	if old == nil then
		new[2].Visible = true
		library.currentTab = new
		services.TweenService:Create(new[1], TweenInfo.new(0.1), {ImageTransparency = 0}):Play()
		services.TweenService:Create(new[1].TabText, TweenInfo.new(0.1), {TextTransparency = 0}):Play()
		return
	end
	if old[1] == new[1] then return end
	switchingTabs = true
	library.currentTab = new
	services.TweenService:Create(old[1], TweenInfo.new(0.1), {ImageTransparency = 0.2}):Play()
	services.TweenService:Create(new[1], TweenInfo.new(0.1), {ImageTransparency = 0}):Play()
	services.TweenService:Create(old[1].TabText, TweenInfo.new(0.1), {TextTransparency = 0.2}):Play()
	services.TweenService:Create(new[1].TabText, TweenInfo.new(0.1), {TextTransparency = 0}):Play()
	old[2].Visible = false
	new[2].Visible = true
	task.wait(0.1)
	switchingTabs = false
end

function drag(frame, hold)
	if not hold then hold = frame end
	local dragging, dragInput, dragStart, startPos
	local function update(input)
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
	hold.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	services.UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

function library.new(library, name, theme)
	for _, v in next, services.CoreGui:GetChildren() do
		if v.Name == "frosty" then v:Destroy() end
	end
	local MainColor, Background, zyColor
	if theme == 'qing' then
		MainColor = Color3.fromRGB(29, 45, 70)
		Background = Color3.fromRGB(17, 31, 50)
		zyColor = Color3.fromRGB(29, 45, 70)
	else
		MainColor = Color3.fromRGB(20, 20, 20)
		Background = Color3.fromRGB(25, 25, 25)
		zyColor = Color3.fromRGB(20, 20, 20)
	end
	local dogent = Instance.new("ScreenGui")
	dogent.Name = "Virtual"
	dogent.Parent = services.CoreGui.RobloxGui
	if syn and syn.protect_gui then syn.protect_gui(dogent) end
	local Main = Instance.new("Frame")
	Main.Name = "Main"
	Main.Parent = dogent
	Main.AnchorPoint = Vector2.new(0.5, 0.5)
	Main.BackgroundColor3 = Background
	Main.BorderColor3 = MainColor
	Main.Position = UDim2.new(0.5, 0, 0.5, 0)
	Main.Size = UDim2.new(0, 572, 0, 353)
	Main.ZIndex = 1
	Main.Active = true
	Main.Draggable = true
	drag(Main)
	services.UserInputService.InputEnded:Connect(function(input)
		if input.KeyCode == Enum.KeyCode.LeftControl then
			Main.Visible = not Main.Visible
		end
	end)
	local TabMain = Instance.new("Frame")
	TabMain.Name = "TabMain"
	TabMain.Parent = Main
	TabMain.BackgroundTransparency = 1
	TabMain.Size = UDim2.new(0, 448, 0, 350)
	local Side = Instance.new("Frame")
	Side.Name = "Side"
	Side.Parent = Main
	Side.BackgroundTransparency = 1
	Side.Size = UDim2.new(0, 110, 0, 353)
	local TabBtns = Instance.new("ScrollingFrame")
	TabBtns.Name = "TabBtns"
	TabBtns.Parent = Side
	TabBtns.Size = UDim2.new(0, 110, 0, 318)
	TabBtns.ScrollBarThickness = 0
	local TabBtnsL = Instance.new("UIListLayout")
	TabBtnsL.Parent = TabBtns
	TabBtnsL.Padding = UDim.new(0, 12)
	local ScriptTitle = Instance.new("TextLabel")
	ScriptTitle.Name = "ScriptTitle"
	ScriptTitle.Parent = Side
	ScriptTitle.Size = UDim2.new(0, 102, 0, 20)
	ScriptTitle.Font = Enum.Font.GothamSemibold
	ScriptTitle.Text = name
	ScriptTitle.TextColor3 = Color3.new(1, 1, 1)
	ScriptTitle.TextSize = 14
	ScriptTitle.TextXAlignment = Enum.TextXAlignment.Left
	local Open = Instance.new("TextButton")
	Open.Name = "Open"
	Open.Parent = dogent
	Open.Size = UDim2.new(0, 61, 0, 32)
	Open.Position = UDim2.new(0.008, 0, 0.311, 0)
	Open.Text = "隐藏/打开"
	Open.BackgroundColor3 = MainColor
	Open.TextColor3 = Color3.new(1, 1, 1)
	Open.MouseButton1Click:Connect(function() Main.Visible = not Main.Visible end)

	local window = {}
	function window.Tab(window, name, icon)
		local Tab = Instance.new("ScrollingFrame")
		Tab.Name = "Tab"
		Tab.Parent = TabMain
		Tab.Size = UDim2.new(1, 0, 1, 0)
		Tab.ScrollBarThickness = 0
		Tab.Visible = false
		local TabIco = Instance.new("ImageLabel")
		TabIco.Name = "TabIco"
		TabIco.Parent = TabBtns
		TabIco.Size = UDim2.new(0, 24, 0, 24)
		TabIco.Image = ("rbxassetid://%s"):format(icon or 4370341699)
		TabIco.ImageTransparency = 0.2
		local TabText = Instance.new("TextLabel")
		TabText.Name = "TabText"
		TabText.Parent = TabIco
		TabText.Size = UDim2.new(0, 76, 0, 24)
		TabText.Font = Enum.Font.GothamSemibold
		TabText.Text = name
		TabText.TextColor3 = Color3.new(1, 1, 1)
		TabText.TextSize = 14
		TabText.TextXAlignment = Enum.TextXAlignment.Left
		TabText.TextTransparency = 0.2
		local TabBtn = Instance.new("TextButton")
		TabBtn.Name = "TabBtn"
		TabBtn.Parent = TabIco
		TabBtn.Size = UDim2.new(0, 110, 0, 24)
		TabBtn.BackgroundTransparency = 1
		TabBtn.Text = ""
		TabBtn.AutoButtonColor = false
		TabBtn.MouseButton1Click:Connect(function()
			Ripple(TabBtn)
			switchTab({TabIco, Tab})
		end)
		if library.currentTab == nil then
			switchTab({TabIco, Tab})
		end
		local tab = {}
		function tab.section(tab, name, TabVal)
			local Section = Instance.new("Frame")
			Section.Name = "Section"
			Section.Parent = Tab
			Section.Size = UDim2.new(0.981, 0, 0, 36)
			Section.BackgroundTransparency = 1
			local Objs = Instance.new("Frame")
			Objs.Name = "Objs"
			Objs.Parent = Section
			Objs.Size = UDim2.new(0.986, 0, 0, 0)
			Objs.BackgroundTransparency = 1
			local ObjsL = Instance.new("UIListLayout")
			ObjsL.Parent = Objs
			ObjsL.Padding = UDim.new(0, 8)
			local section = {}
			function section.Button(section, text, callback)
				local Btn = Instance.new("TextButton")
				Btn.Name = "Btn"
				Btn.Parent = Objs
				Btn.Size = UDim2.new(0, 428, 0, 38)
				Btn.BackgroundColor3 = zyColor
				Btn.AutoButtonColor = false
				Btn.Font = Enum.Font.GothamSemibold
				Btn.Text = "   " .. text
				Btn.TextColor3 = Color3.new(1, 1, 1)
				Btn.TextSize = 16
				Btn.TextXAlignment = Enum.TextXAlignment.Left
				local BtnC = Instance.new("UICorner")
				BtnC.CornerRadius = UDim.new(0, 6)
				BtnC.Parent = Btn
				Btn.MouseButton1Click:Connect(function()
					Ripple(Btn)
					spawn(callback)
				end)
			end
			function section.Toggle(section, text, flag, enabled, callback)
				enabled = enabled or false
				assert(text and flag, "Toggle needs text & flag")
				library.flags[flag] = enabled
				callback = callback or function() end
				local ToggleBtn = Instance.new("TextButton")
				ToggleBtn.Name = "ToggleBtn"
				ToggleBtn.Parent = Objs
				ToggleBtn.Size = UDim2.new(0, 428, 0, 38)
				ToggleBtn.BackgroundColor3 = zyColor
				ToggleBtn.AutoButtonColor = false
				ToggleBtn.Font = Enum.Font.GothamSemibold
				ToggleBtn.Text = "   " .. text
				ToggleBtn.TextColor3 = Color3.new(1, 1, 1)
				ToggleBtn.TextSize = 16
				ToggleBtn.TextXAlignment = Enum.TextXAlignment.Left
				local ToggleBtnC = Instance.new("UICorner")
				ToggleBtnC.CornerRadius = UDim.new(0, 6)
				ToggleBtnC.Parent = ToggleBtn
				local ToggleSwitch = Instance.new("Frame")
				ToggleSwitch.Name = "ToggleSwitch"
				ToggleSwitch.Parent = ToggleBtn
				ToggleSwitch.Size = UDim2.new(0, 36, 0, 22)
				ToggleSwitch.Position = UDim2.new(0.9, 0, 0.5, 0)
				ToggleSwitch.AnchorPoint = Vector2.new(1, 0.5)
				ToggleSwitch.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
				local ToggleSwitchC = Instance.new("UICorner")
				ToggleSwitchC.CornerRadius = UDim.new(0, 6)
				ToggleSwitchC.Parent = ToggleSwitch
				local funcs = {
					SetState = function(self, state)
						state = state == nil and not library.flags[flag] or state
						if library.flags[flag] == state then return end
						library.flags[flag] = state
						services.TweenService:Create(ToggleSwitch, TweenInfo.new(0.2), {
							BackgroundColor3 = state and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(50, 50, 50)
						}):Play()
						callback(state)
					end
				}
				funcs:SetState(flag, enabled)
				ToggleBtn.MouseButton1Click:Connect(function() funcs:SetState() end)
				return funcs
			end
			return section
		end
		return tab
	end
	return window
end
return library

